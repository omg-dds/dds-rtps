name: Generate Doc
run-name: ${{ github.actor }} is generating doc in GitHub Actions ðŸš€
on:
  workflow_run:
      workflows: ["Upload Artifact"]
      types:
          - completed
jobs:
  generate_doc:
    runs-on: ubuntu-latest
    steps:
      - name: Get Artifact
        uses: dawidd6/action-download-artifact@v3
        with:
          name: detailed_report
          workflow: upload_artifact.yml

      - name: Move the detailed report to output folder
        run: |
          mkdir -p html/detailed_report
          mv *.html html/detailed_report/

      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11.4'

      - name: Create virtual environment
        run: python -m venv .venv

      - name: Install Google API dependencies
        run: |
          source .venv/bin/activate
          pip install google-api-python-client

      - name: Get latest XLSX and ZIP urls
        env:
          GCP_CREDENTIAL_STR: ${{ secrets.GCP_CREDENTIAL_STR }}
          DRIVE_FOLDER_ID: ${{ secrets.DRIVE_FOLDER_ID }}
        run: python get_latest_file_urls.py gdrive_url.py

      - name: Install Sphinx dependencies
        run: |
          pip install sphinx sphinx_rtd_theme

      - name: Build documentation
        run: |
          sphinx-build -b html doc html
          working-directory: ${{ github.workspace }}

      - name: Attach html documentation
        uses: actions/upload-artifact@v4
        with:
          name: interoperability_report
          path: |
            ./html/*.*

